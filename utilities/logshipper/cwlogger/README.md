This code is from https://github.com/jcxplorer/cwlogger (in https://github.com/jcxplorer/cwlogger/pull/1)